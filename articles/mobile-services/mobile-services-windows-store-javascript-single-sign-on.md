<properties 
	pageTitle="Autenticar seu aplicativo com o Live Connect (JavaScript)" 
	description="Saiba como usar o logon único do Live Connect nos serviços móveis do Azure de um aplicativo da Windows Store." 
	services="mobile-services" 
	documentationCenter="windows" 
	authors="ggailey777" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="mobile-services" 
	ms.workload="mobile" 
	ms.tgt_pltfrm="mobile-windows-store" 
	ms.devlang="javascript" 
	ms.topic="article" 
	ms.date="08/08/2015" 
	ms.author="glenga"/>

# Autenticar seu aplicativo da Windows Store com autenticação gerenciada do cliente usando a conta da Microsoft

[AZURE.INCLUDE [mobile-services-selector-single-signon](../../includes/mobile-services-selector-single-signon.md)]

##Visão geral
Este tópico mostra como autenticar usuários nos Serviços Móveis do Azure em seu aplicativo da Windows Store. Neste tutorial, você adiciona autenticação ao projeto quickstart usando o Live Connect. Quando autenticado com êxito pelo Live Connect, um usuário conectado é recebido pelo nome e o valor da ID do usuário é exibido.

>[AZURE.NOTE]Este tutorial demonstra os benefícios de usar a autenticação gerenciada pelo cliente e o Live SDK. Isso permite que você autentique mais facilmente um usuário já conectado com seu serviço móvel. Você também pode solicitar escopos adicionais para permitir que seu aplicativo acesse recursos como o OneDrive. A autenticação gerenciada pelo serviço oferece uma experiência mais generalizada que dê suporte a vários provedores de autenticação. Para saber mais sobre a autenticação gerenciada por serviço, consulte o tópico [Adicionar autenticação ao seu aplicativo](mobile-services-windows-store-javascript-get-started-users.md).

Este tutorial exige o seguinte:

+ [Live SDK para Windows]
+ Microsoft Visual Studio 2012 Express para Windows 8 RC ou uma versão posterior
+ Você também deve concluir primeiro o tutorial [Adicionar Serviços Móveis a um aplicativo existente].

##Registrar seu aplicativo para usar a conta da Microsoft para autenticação

Para poder autenticar usuários, você deverá registrar seu aplicativo na Central de desenvolvedores da conta da Microsoft. Em seguida, você deve conectar esse registro ao serviço móvel. Conclua as etapas no tópico a seguir para criar um registro de conta da Microsoft e conectá-lo ao seu serviço móvel.

+ [Registrar seus aplicativos para usar um logon de conta da Microsoft](mobile-services-how-to-register-microsoft-authentication.md)

##<a name="permissions"></a>Restringir permissões a usuários autenticados

Em seguida, você precisará restringir o acesso a um recurso, neste caso, a tabela *TodoItems*, para certificar-se de que ele só poderá ser acessado por um usuário conectado.

[AZURE.INCLUDE [mobile-services-restrict-permissions-windows](../../includes/mobile-services-restrict-permissions-windows.md)]

##<a name="add-authentication"></a>Adicionar autenticação ao aplicativo

Por fim, você adiciona o Live SDK e o utiliza para autenticar usuários em seu aplicativo.

1. No **Gerenciador de Soluções**, clique com o botão direito do mouse na solução e então clique em **Gerenciar pacotes NuGet**.

2. No painel esquerdo, selecione a categoria **Online**, procure **LiveSDK**, clique em **Instalar** no pacote **Live SDK**, selecione todos os projetos e aceite os contratos de licença.

  	Isso adiciona o Live SDK à solução.

3. Abra o arquivo de projeto default.html e adicione o seguinte elemento `<script>` no elemento `<head>`.

        <script src="/js/wl.js"></script>

5. Na sobrecarga do método **app.OnActivated**, substitua a chamada para o método **refreshTodoItems** pelo seguinte código:
	
        // Set the mobileClient variable to client variable generated by the tooling.
        var mobileClient = <yourClient>;

        var session = null;
        var login = function () {
            return new WinJS.Promise(function (complete) {
                WL.login({ scope: "wl.basic" }).then(function (result) {
                    session = result.session;

                    WinJS.Promise.join([
                        WL.api({ path: "me", method: "GET" }),
                        mobileClient.login(result.session.authentication_token)
                    ]).done(function (results) {
                        // Build the welcome message from the Microsoft account info.
                        var profile = results[0];                            
                        var title = "Welcome " + profile.first_name + "!";
                        var message = "You are now logged in as: "
                            + mobileClient.currentUser.userId;
                        var dialog = new Windows.UI.Popups.MessageDialog(message, title);
                        dialog.showAsync().then(function () {
                            // Reload items from the mobile service.
                            refreshTodoItems();
                        }).done(complete);
                        
                    }, function (error) {

                    });
                }, function (error) {
                    session = null;
                    var dialog = new Windows.UI.Popups.MessageDialog("You must log in.", "Login Required");
                    dialog.showAsync().done(complete);
                });
            });
        }

        var authenticate = function () {
            // Block until sign-in is successful.
            login().then(function () {
                if (session === null) {
                    // Authentication failed, try again.
                    authenticate();
                }
            });
        }

		// Initialize the Live client.
        WL.init({
            redirect_uri: mobileClient.applicationUrl
        });

		// Start the sign-in process.
        authenticate();

    Isso inicializa o cliente do Live Connect, envia uma nova solicitação de logon à conta da Microsoft, envia o token de autenticação retornado aos Serviços Móveis e, em seguida, exibe informações sobre o usuário conectado.

	>[AZURE.NOTE]Idealmente, você não deve solicitar os tokens de autenticação do Live Connection ou tokens de autenticação dos Serviços Móveis todas as vezes que o seu aplicativo executar. Além disto ser ineficiente, você pode se deparar com problemas relacionados ao uso caso muitos consumidores tentem iniciar o aplicativo ao mesmo tempo. Uma abordagem melhor é armazenar em cache os tokens e primeiro tentar usar o token dos Serviços Móveis em cache antes de chamar **LoginWithMicrosoftAccountAsync**. Para obter um exemplo de como armazenar em cache este token, consulte [Introdução à autenticação](mobile-services-windows-store-javascript-get-started-users.md#tokens).
	
7. Substitua o valor `<yourClient>` na primeira linha do código acima pela variável definida no arquivo .js adicionado quando você conecta seu projeto ao serviço móvel.
		
8. Pressione a tecla F5 para executar o aplicativo e entre na sua conta da Microsoft.

   	Ao entrar com êxito, o aplicativo deverá ser executado sem erros e você deverá ser capaz de consultar os Serviços Móveis e fazer atualizações nos dados.

## <a name="next-steps"> </a>Próximas etapas

No próximo tutorial, [Autorizar usuários com scripts], você irá obter o valor da ID de usuário fornecido pelos Serviços Móveis com base em um usuário autenticado e usar para filtrar os dados retornados pelos Serviços Móveis. Para obter informações sobre como usar outros provedores de identidade para autenticação, consulte [Introdução à autenticação].

<!-- Anchors. -->
[Register your app for authentication and configure Mobile Services]: #register
[Restrict table permissions to authenticated users]: #permissions
[Add authentication to the app]: #add-authentication
[Next Steps]: #next-steps

<!-- Images. -->

<!-- URLs. -->
[Submit an app page]: http://go.microsoft.com/fwlink/p/?LinkID=266582
[My Applications]: http://go.microsoft.com/fwlink/p/?LinkId=262039
[Live SDK para Windows]: http://go.microsoft.com/fwlink/p/?LinkId=262253
[Adicionar Serviços Móveis a um aplicativo existente]: mobile-services-windows-store-javascript-get-started-data.md
[Introdução à autenticação]: mobile-services-windows-store-javascript-get-started-users.md
[Autorizar usuários com scripts]: ../mobile-services-windows-store-javascript-authorize-users-in-scripts.md

[Azure Management Portal]: https://manage.windowsazure.com/
 

<!---HONumber=August15_HO7-->