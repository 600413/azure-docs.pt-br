<properties
   pageTitle="Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais | Microsoft Azure"
   description="Este artigo fornece uma visão geral da arquitetura do Microsoft Antimalware para Azure, incluindo cenários com suporte e configurações para habilitar, configurar e implantar proteção para os Serviços de Nuvem do Azure e Máquinas Virtuais. Abordaremos a configuração básica, o gerenciamento e o monitoramento de funcionalidade acessível por meio de APIs de gerenciamento do serviço Microsoft Azure, PowerShell scripts, Portal de Gerenciamento do Azure e Visual Studio."
   services="virtual-machines, cloud-services, storage"
   documentationCenter="na"
   authors="YuriDio"
   manager="swadhwa"
   editor=""/>

<tags
   ms.service="azure-security"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="10/07/2015"
   ms.author="yuridio"/>

#Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais

O panorama atual de ameaças a ambientes de nuvem é extremamente dinâmico, aumentando a pressão sobre assinantes de nuvem de TI comercial para manter uma proteção eficaz e atender aos requisitos de conformidade e segurança na nuvem. O Microsoft Antimalware para Serviços de Nuvem do Azure e Máquinas Virtuais é uma funcionalidade de proteção em tempo real que ajuda a identificar e remover vírus, spyware e outros softwares mal-intencionados, com alertas configuráveis quando se sabe que software mal-intencionado ou indesejado tenta se instalar ou executar no seus sistemas do Azure.

A solução baseia-se na mesma plataforma de antimalware do MSE ( Microsoft Security Essentials), do Microsoft Forefront Endpoint Protection, do Microsoft System Center Endpoint Protection, do Windows Intune e do Windows Defender para Windows 8.0 e posterior. O Antimalware da Microsoft para Azure é uma solução de agente único para aplicativos e ambientes de locatário, projetado para ser executado em segundo plano sem intervenção humana. Você pode implantar a proteção baseada nas necessidades de suas cargas de trabalho do aplicativo, com configuração básica padronizada ou personalizada avançada, incluindo monitoramento de antimalware.

Quando você implanta e habilita o Microsoft Antimalware do Azure para seus aplicativos, os seguintes recursos principais ficam disponíveis:

**Proteção em tempo real**: monitora a atividade em Serviços de Nuvem e em Máquinas Virtuais para detectar e bloquear a execução de malware.

**Varredura programada**: executa periodicamente varredura direcionada para detectar malware, incluindo programas ativamente em execução.

**Remediação de Malware**: atua automaticamente sobre o malware detectado, por exemplo, excluindo ou colocando arquivos mal-intencionados em quarentena e limpando entradas de registro mal-intencionado.

**Atualizações de assinatura**: instala automaticamente as últimas assinaturas de proteção (definições de vírus) para garantir que a proteção esteja atualizada em um intervalo predeterminado.

**Atualizações de mecanismo Antimalware**: atualiza automaticamente o mecanismo Microsoft Antimalware.

**Atualizações da plataforma Antimalware**: atualiza automaticamente a plataforma Microsoft Antimalware.

**Proteção ativa**: reporta metadados de telemetria sobre ameaças detectadas e recursos suspeitos ao Microsoft Azure para garantir uma resposta rápida ao panorama de ameaças em constante evolução, além de habilitar a entrega de assinatura síncrona em tempo real por meio do MAPS (Microsoft Active Protection System).

**Relatórios de exemplos**: fornece e relata exemplos para o serviço Microsoft Antimalware para ajudar a aprimorar o serviço e a habilitar a solução de problemas.

**Exclusões**: permite que os administradores de serviço e aplicativo configurem determinados arquivos, processos e unidades para excluí-los da proteção e da verificação por motivos de desempenho e/ou outros.

**Coleta de eventos de Antimalware**: registra a integridade do serviço de antimalware, atividades suspeitas e ações de remediação realizadas no log de eventos do sistema operacional e os coleta na conta de armazenamento do Azure do cliente.

##Arquitetura

O Microsoft Antimalware para Serviços de Nuvem do Azure e Máquinas Virtuais inclui o cliente e o serviço Microsoft Antimalware, a extensão de gerenciamento do serviço Antimalware, cmdlets do PowerShell de Antimalware e a extensão Azure Diagnostics. A solução Microsoft Antimalware tem suporte no Windows Server 2008 R2, no Windows Server 2012 e nas famílias de sistemas operacionais Windows Server 2012 R2. Não há suporte no sistema operacional Windows Server 2008. Neste momento, não há suporte para o Windows Server Technical Preview; temos a intenção de dar suporte no futuro.

O cliente e serviço Microsoft Antimalware é instalado por padrão em estado desabilitado em todas as famílias de sistema operacional convidado do Azure com suporte na plataforma de Serviços de Nuvem.

O cliente e serviço Microsoft Antimalware não é instalado por padrão na plataforma Máquinas Virtuais e está disponível como um recurso opcional nas configurações do Portal de Gerenciamento do Azure e da Máquina Virtual do Visual Studio em Extensões de Segurança.

###Fluxo de trabalho do Microsoft Antimalware

O administrador do serviço Azure pode habilitar Antimalware para o Azure com configuração padrão ou personalizada para suas Máquinas Virtuais e Serviços de Nuvem usando as seguintes opções:

-   Máquinas Virtuais – no Portal de Gerenciamento do Azure, em Extensões de Segurança

-   Máquinas Virtuais – usando a configuração de máquinas virtuais do Visual Studio no Gerenciador de Servidores

-   Máquinas Virtuais e Serviços de Nuvem – usando as APIs de gerenciamento de serviço Antimalware (SMAPI)

-   Máquinas Virtuais e Serviços de Nuvem – usando cmdlets Antimalware do PowerShell

O Portal de Gerenciamento do Azure ou os cmdlets do PowerShell enviam por push o arquivo de pacote de extensão de Antimalware no sistema do Azure para determinado local fixo. O agente convidado do Azure (ou o agente de malha) inicia a extensão do Antimalware, aplicando as configurações de Antimalware fornecidas como entrada. Esta etapa habilita o serviço Antimalware com configurações personalizadas ou padrão. Se nenhuma configuração personalizada for fornecida, o serviço de antimalware estará habilitado com as configurações padrão. Consulte a seção *Configuração de Antimalware* em [Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo](http://aka.ms/amazsamples "Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais Códigos de exemplo") para obter mais detalhes.

Quando em execução, o cliente Microsoft Antimalware baixa as definições mais recentes de mecanismo e assinatura de proteção da Internet e carrega-as no sistema do Azure. O serviço Microsoft Antimalware grava eventos relacionados ao serviço no log de eventos de sistema operacional do sistema, na origem de evento "Microsoft Antimalware". Eventos incluem o estado de integridade, de proteção e atualização do cliente Antimalware, configurações novas e antigas, atualizações de mecanismos, definições de assinatura e outros.

Você pode habilitar o monitoramento de Antimalware para seu Serviço de Nuvem ou Máquina Virtual para que os eventos de log de eventos de Antimalware sejam gravados conforme vão sendo gerados para sua conta de armazenamento do Azure. O serviço Antimalware usa a extensão de diagnóstico do Azure para coletar eventos de Antimalware do sistema do Azure e colocar em tabelas na conta de armazenamento do Azure do cliente.

O fluxo de trabalho de implantação, incluindo etapas de configuração e opções com suporte para os cenários acima, está documentado na seção [Cenários de implantação de antimalware](#_Antimalware_Deployment_Scenarios) deste documento.

![Microsoft Antimalware no Azure](./media/azure-security-antimalware/sec-azantimal-fig1.PNG)

###Configuração de Antimalware personalizada e padrão

As configurações padrão são aplicadas para habilitar o Antimalware para os Serviços de Nuvem do Azure ou Máquinas Virtuais quando você não fornecer as configurações personalizadas. As configurações padrão foram previamente otimizadas para execução no ambiente do Azure. Opcionalmente, você pode personalizar essas configurações padrão conforme necessário para seu aplicativo ou implantação do serviço do Azure e aplicá-las em outros cenários de implantação.

A tabela a seguir resume as configurações disponíveis para o serviço Antimalware. As configurações padrão estão marcadas na coluna rotulada "Padrão" abaixo.

![Tabela 1](./media/azure-security-antimalware/sec-azantimal-tb18.PNG)

##Cenários de implantação de antimalware

Os cenários para habilitar e configurar o antimalware, incluindo monitoramento de Serviços de Nuvem do Azure e Máquinas Virtuais, são discutidos nesta seção.

###Máquinas Virtuais - habilitar e configurar o Antimalware

**Implantação usando o Portal de Visualização do Azure**

Para habilitar o serviço de Antimalware, clique em **Adicionar** na folha Extensões, selecione **Microsoft Antimalware** na folha Novo recurso e clique em **Criar** na folha Microsoft Antimalware. Clique em **Criar** sem inserir qualquer valor de configuração para habilitar o Antimalware com as configurações padrão ou insira as configurações de Antimalware para a Máquina Virtual configurada como mostrado na Figura 2 abaixo. Consulte as **dicas de ferramenta** fornecidas com cada configuração na folha Adicionar Extensão para ver os valores de configuração com suporte.

![Definições de configuração de máquina virtual para o Microsoft Antimalware](./media/azure-security-antimalware/sec-azantimal-fig2.PNG)

**Implantação usando o Portal de Gerenciamento do Azure**

Para habilitar e configurar o Microsoft Antimalware para Máquinas Virtuais do Azure usando o Portal de Gerenciamento do Azure ao provisionar uma máquina Virtual, siga as etapas abaixo:

1\. Faça logon no Portal de Gerenciamento do Azure em <https://manage.windowsazure.com>

2\. Para criar uma nova máquina virtual, clique em **Novo**, **Computação**, **Máquina** **Virtual**, **Da Galeria** (não use Criação Rápida) conforme mostrado abaixo:

![Nova máquina virtual](./media/azure-security-antimalware/sec-azantimal-fig3.PNG)


3\. Selecione a imagem do **Microsoft Windows Server** na página **Escolha uma Imagem**.

4\. Clique na seta para a direita e insira a configuração de Máquina Virtual.

5\. Marque a caixa de seleção **Microsoft Antimalware** em **Extensões de Segurança** na página de configuração da Máquina Virtual.

6\. Clique no botão Enviar para habilitar e configurar o Microsoft Antimalware para Máquinas Virtuais do Azure com configurações padrão.

![Configuração de máquina virtual](./media/azure-security-antimalware/sec-azantimal-fig4.PNG)

**Implantação usando a configuração de Máquina Virtual do Visual Studio**

Para habilitar e configurar o serviço Microsoft Antimalware usando o Visual Studio:

1\. Conecte-se ao Microsoft Azure no Visual Studio.

2\. Escolha sua máquina virtual no nó **máquinas virtuais** no **Gerenciador de Servidores**.

![Configuração da Máquina Virtual no Visual Studio](./media/azure-security-antimalware/sec-azantimal-fig5.PNG)

3\. Clique com botão direito do mouse em **Configurar** para exibir a página de configuração da Máquina Virtual

4\. Selecione a extensão **Microsoft Antimalware** na lista suspensa em **Extensões Instaladas** e clique em **Adicionar** para definir com a configuração de antimalware padrão.

![Extensões instaladas](./media/azure-security-antimalware/sec-azantimal-fig6.PNG)

5\. Para personalizar a configuração de Antimalware padrão, selecione (realce) a extensão do Antimalware na lista de extensões instaladas e clique em **Configurar**.

6\. Substitua a configuração de Antimalware padrão com sua configuração personalizada no formato JSON com suporte na caixa de texto **configuração pública** e clique em OK.

7\. Clique no botão **Atualizar** para enviar as atualizações de configuração para a Máquina Virtual.

![Extensão de configuração de máquina virtual](./media/azure-security-antimalware/sec-azantimal-fig7.PNG)

**Observação:** a configuração de Máquinas Virtuais do Visual Studio para Antimalware dá suporte somente à configuração no formato JSON. O modelo de definições de configuração de Antimalware JSON está incluído no [Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo](http://aka.ms/amazsamples "Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo"), mostrando as configurações de Antimalware com suporte.

**Implantação usando cmdlets do PowerShell**

Um aplicativo ou serviço do Azure pode habilitar e configurar o Microsoft Antimalware para máquinas virtuais do Azure usando cmdlets do PowerShell.

Para habilitar e configurar o Microsoft Antimalware usando cmdlets de antimalware do PowerShell:

1. Configurar o ambiente do PowerShell - consulte a documentação em <https://github.com/Azure/azure-sdk-tools#get-started>

2. Use o cmdlet Set-AzureVMMicrosoftAntimalwareExtension Antimalware para habilitar e configurar o Microsoft Antimalware para sua máquina Virtual, conforme documentado em <http://msdn.microsoft.com/library/azure/dn771718.aspx>

**Observação:** a configuração de Máquinas Virtuais do Azure para Antimalware dá suporte somente à configuração no formato JSON. O modelo de definições de configuração de Antimalware JSON está incluído no [Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo](http://aka.ms/amazsamples "Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo"), mostrando as configurações de Antimalware com suporte.

###Habilitar e configurar o Antimalware usando cmdlets do PowerShell

Um aplicativo ou serviço do Azure pode habilitar e configurar o Microsoft Antimalware para Serviços de Nuvem do Azure usando cmdlets do PowerShell. Observe que o Microsoft Antimalware é instalado em um estado desabilitado na plataforma Serviços de Nuvem e requer uma ação de um aplicativo do Azure para habilitá-lo.

Para habilitar e configurar o Microsoft Antimalware usando o cmdlets do PowerShell:

1.  Configurar o ambiente do PowerShell - consulte a documentação em <https://github.com/Azure/azure-sdk-tools#get-started>

2.  Use o cmdlet Antimalware Set-ServiceAntimalwareExtension para habilitar e configurar o Microsoft Antimalware para seu Serviço de Nuvem, conforme documentado em <http://msdn.microsoft.com/library/azure/dn771718.aspx>

O modelo de definições de configuração de Antimalware XML está incluído no [Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo](http://aka.ms/amazsamples "Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo"), mostrando as configurações de Antimalware com suporte.

###Serviços de Nuvem e Máquinas Virtuais – configuração usando cmdlets do PowerShell

Um aplicativo ou serviço Azure pode recuperar a configuração do Microsoft Antimalware para Serviços de Nuvem e Máquinas Virtuais usando cmdlets do PowerShell.

Para recuperar a configuração do Microsoft Antimalware usando cmdlets do PowerShell:

1.  Configurar o ambiente do PowerShell - consulte a documentação em <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **Para Máquinas Virtuais**: use o cmdlet Get-AzureVMMicrosoftAntimalwareExtension Antimalware para obter a configuração de antimalware documentada em <http://msdn.microsoft.com/library/azure/dn771719.aspx>

3.  **Para Serviços de Nuvem**: use o cmdlet Antimalware Get-AzureServiceAntimalwareConfig para obter a configuração de Antimalware documentada em <http://msdn.microsoft.com/library/azure/dn771722.aspx>

###Remover a configuração de Antimalware usando cmdlets do PowerShell

Um aplicativo ou serviço Azure pode remover a configuração de monitoramento de Antimalware e configurações de monitoramento de Antimalware associadas do Azure Antimalware e extensões de serviço de diagnóstico relevantes associados ao Serviço de Nuvem ou à Máquina Virtual.

Para remover o Microsoft Antimalware usando cmdlets do PowerShell:

1.  Configurar o ambiente do PowerShell - consulte a documentação em <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **Para máquinas virtuais**: usar o cmdlet Antimalware Remove-AzureVMMicrosoftAntimalwareExtension documentado em <http://msdn.microsoft.com/library/azure/dn771720.aspx>

3.  **Para Serviços de Nuvem**: usar o cmdlet Antimalware Remove-AzureServiceAntimalwareExtension documentado em <http://msdn.microsoft.com/library/azure/dn771717.aspx>

Para **habilitar** a coleta de eventos de antimalware para uma máquina virtual usando o Portal de Visualização do Azure:

1.  Clique em qualquer parte da Lente monitoramento na folha de Máquina Virtual

2.  Clique no comando Diagnóstico na folha Métrica

3.  Selecione **Status** Ativo (ON) e verifique a opção para logs de sistema de eventos do Windows. Você pode optar por desmarcar todas as outras opções na lista ou deixá-las habilitadas de acordo com as suas necessidades de serviço do aplicativo.

4.  As categorias de eventos de Antimalware "Erro", "Aviso", "Informativo" e outras são capturadas na sua conta de armazenamento do Azure.

Os eventos de antimalware são coletados dos logs de sistema de eventos do Windows para sua conta de armazenamento do Azure. Você pode configurar a conta de armazenamento para que sua Máquina Virtual colete eventos de antimalware selecionando a conta de armazenamento apropriado.

![Métricas e diagnóstico](./media/azure-security-antimalware/sec-azantimal-fig8.PNG)

###Habilitar e configurar o Monitoramento de Antimalware usando cmdlets do PowerShell

Você pode habilitar a coleção de eventos de Microsoft Antimalware para seu Serviço de Nuvem ou Máquina Virtual usando o diagnóstico do Azure por meio de cmdlets de Antimalware do PowerShell. A extensão de diagnóstico do Azure pode ser configurada para capturar eventos da fonte do log de eventos do sistema "Microsoft Antimalware" à sua conta de armazenamento do Azure. As categorias de eventos de Antimalware "Erro", "Aviso", "Informativo" e outras são capturadas na sua conta de armazenamento do Azure.

Para habilitar a coleta de eventos de Antimalware para sua conta de armazenamento do Azure usando cmdlets do PowerShell:

1.  Configurar o ambiente do PowerShell - consulte <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **Para Máquinas Virtuais** -usar o cmdlet Antimalware Set-AzureVMMicrosoftAntimalwareExtension com opção Monitoramento Ativado, conforme documentado em <http://msdn.microsoft.com/library/azure/dn771716.aspx>

3.  **Para Serviços de Nuvem** -usar o cmdlet Antimalware Set-AzureServiceAntimalwareExtension com opção Monitoramento Ativado, conforme documentado em <http://msdn.microsoft.com/library/azure/dn771718.aspx>

Você pode exibir os eventos brutos Antimalware examinando a tabela WADWindowsEventLogsTable na sua conta de armazenamento do Azure configurada para habilitar o monitoramento de Antimalware. Isso pode ser útil para validar que a coleta de eventos de antimalware está funcionando, incluindo a obtenção de informações sobre a integridade do serviço de antimalware. Para obter mais detalhes, incluindo o código de exemplo sobre como extrair eventos de Antimalware da sua conta de armazenamento, consulte [Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo](http://aka.ms/amazsamples "Microsoft Antimalware para Serviços de Nuvem do Azure e máquinas virtuais - Códigos de exemplo").

<!---HONumber=Nov15_HO1-->