	<properties		pageTitle="Using linux diagnostic extension to monitor linux vm’s performance and diagnostic data"		description="Learn how to linux diagnostic extension to monitor linux vm’s performance and diagnostic data."		services="virtual-machines"		documentationCenter=""    	authors="Ning"		manager="timlt"		editor=""    	tags=""/>	<tags		ms.service="virtual-machines"		ms.workload="infrastructure-services"		ms.tgt_pltfrm="vm-linux"		ms.devlang="na"		ms.topic="article"		ms.date="06/04/2015"		ms.author="Ning"/>#Usando a Extensão de Diagnóstico do Linux para monitorar os dados de desempenho e de diagnóstico da VM Linux##Introdução A extensão de diagnóstico do Linux ajuda o usuário a monitorar as VMs Linux em execução no Azure, com as seguintes funcionalidades:1.	Coleta e carrega dados de desempenho, de diagnóstico e syslog do sistema da VM Linux na tabela de armazenamento do usuário.2.	Permite que o usuário personalize as métricas de dados que serão coletadas e carregadas.	3.	Permite que o usuário carregue arquivos de log especificados na tabela de armazenamento designada.Para a versão 2.0, os dados incluem:1.	Todos os logs Rsyslog de Linux, incluindo logs de sistema, de segurança e de aplicativos.2.	Todos os dados de sistema especificados neste [documento.](https://scx.codeplex.com/wikipage?title=xplatproviders&referringTitle=Documentation "documento")3.	Arquivos de log especificados pelo usuário.##Como habilitar a extensão A extensão pode ser habilitada por meio do Portal de Gerenciamento do Azure, do PowerShell do Azure ou de scripts CLI do Azure.Para exibir e configurar os dados de desempenho e do sistema diretamente do [Portal de Gerenciamento do Azure](https://ms.portal.azure.com/#), siga estas [etapas](http://azure.microsoft.com/blog/2014/09/02/windows-azure-virtual-machine-monitoring-with-wad-extension/ "URL para o blog do Windows"). Este artigo se concentrará na habilitação e configuração de extensão por meio de comandos da CLI do Azure. Isso permite que você leia e exiba diretamente os dados da tabela de armazenamento.##Pré-requisitos1. Agente Linux do Microsoft Azure versão 2.0.6 ou posterior. Observe que a maioria das imagens da galeria da VM Linux do Azure incluía a versão 2.0.6 e posterior. Você pode executar WAAgent-version para confirmar a versão instalada na VM. Se a VM estiver executando uma versão anterior ao 2.0.6, execute estas [instruções](https://github.com/Azure/WALinuxAgent "instruções") para atualizá-la.2.  [CLI do Azure](./xplat-cli.md "CLI do Azure") Siga [esta diretriz](./xplat-cli-install.md "esta diretriz") para configurar o ambiente da CLI do Azure em seu computador. Após a instalação da CLI do Azure, você poderá usar o comando do azure em sua interface de linha de comando (Bash, Terminal, Prompt de comando) para acessar os comandos da CLI do Azure; por exemplo, execute ‘azure vm extension set --help’ para uso detalhado, 'azure login' para fazer logon no Azure, ‘azure vm list’ para listar todas as máquinas virtuais que você tem no azure.3. Conta de armazenamento para armazenar os dados. Você precisará de um nome de conta de armazenamento e de uma chave de acesso pré-criados para carregar os dados no armazenamento.##Use o comando CLI do Azure para habilitar a extensão de diagnóstico do Linux ###  Cenário 1. Habilitar a extensão com o conjunto de dados padrãoPara a versão 2.0 e posterior, os dados padrão coletados incluem: 1. Todas as informações de Rsyslog (incluindo os logs de sistema, de segurança e de aplicativo)  2. Um conjunto principal de dados do sistema base. Observe que o conjunto de dados completo foi descrito neste [documento](https://scx.codeplex.com/wikipage?title=xplatproviders&referringTitle=Documentation "documento"). Se você quiser habilitar dados extras, prossiga com as etapas no cenário 2 e 3.Etapa 1. Crie um arquivo chamado PrivateConfig.json com o seguinte conteúdo:	{     	"storageAccountName":"the storage account to receive data",     	"storageAccountKey":"the key of the account"	}Etapa 2. Execute ‘azure vm extension set vm\_name LinuxDiagnostic Microsoft.OSTCExtensions 2.* --private-config-path PrivateConfig.json’.###   Cenário 2: Personalizar a métrica do monitor de desempenho  Se você quiser personalizar a tabela dos dados de desempenho e de diagnóstico, siga as etapas abaixo.Etapa 1. Crie um arquivo chamado PrivateConfig.json com o conteúdo a seguir, especifique os dados específicos que você deseja coletar.Para todos os provedores e variáveis que recebem suporte, consulte este [documento](https://scx.codeplex.com/wikipage?title=xplatproviders&referringTitle=Documentation "documento"). Você pode ter várias consultas e armazená-las em várias tabelas, acrescentando mais consultas ao script.Observação: por padrão, os dados de Rsyslog sempre serão coletados.	{     	"storageAccountName":"storage account to receive data",     	"storageAccountKey":"key of the account",      	"perfCfg":[           	{"query":"SELECT PercentAvailableMemory, AvailableMemory, UsedMemory ,PercentUsedSwap FROM SCX_MemoryStatisticalInformation","table":"LinuxMemory"           	}             ]	}Etapa 2. Execute ‘azure vm extension set vm\_name LinuxDiagnostic Microsoft.OSTCExtensions 2.* --private-config-path PrivateConfig.json’###   Cenário 3: Carregando seus próprios arquivos de logSe você quiser coletar determinados arquivos de log e carregá-los em sua conta de armazenamento, execute as etapas a seguir. Você precisa especificar o caminho até o arquivo de log e o nome da tabela para armazenar seu log. Você pode ter vários arquivos de log adicionando várias entradas de arquivo/tabela ao script.Etapa 1. Crie um arquivo chamado PrivateConfig.json com o seguinte conteúdo:	{     	"storageAccountName":"the storage account to receive data",     	"storageAccountKey":"key of the account",      	"fileCfg":[           	{"file":"/var/log/mysql.err",             "table":"mysqlerr"           	}           ]	}Etapa 2. Execute ‘azure vm extension set vm\_name LinuxDiagnostic Microsoft.OSTCExtensions 2.* --private-config-path PrivateConfig.json’###   Cenário 4: Desabilitar a extensão do monitor do LinuxEtapa 1. Crie um arquivo chamado PrivateConfig.json com o seguinte conteúdo:	{     	"storageAccountName":"the storage account to receive data",     	"storageAccountKey":"the key of the account",     	“perfCfg”:[],     	“enableSyslog”:”False”	}Etapa 2. Execute ‘azure vm extension set vm\_name LinuxDiagnostic Microsoft.OSTCExtensions 2.* --private-config-path PrivateConfig.json’##Examinar os dadosOs dados de desempenho e de diagnóstico são armazenados na tabela de armazenamento do Azure. Confira [este artigo](./storage-ruby-how-to-use-table-storage.md "este artigo") sobre como acessar os dados na tabela de armazenamento usando scripts de CLI do Azure.Além disso, você pode usar as ferramentas de interface do usuário a seguir para acessar os dados:1.	Use o Gerenciador de Servidores do Visual Studio. Navegue até sua conta de armazenamento. Após uma execução de cerca de cinco minutos da VM, você deverá ver as tabelas padrão. “LinuxCpu”,”LinuxDisk”,”LinuxMemory”,”Linuxsyslog”. Clique duas vezes no nome da tabela para exibir os dados. 2.	Use o [Gerenciador de Armazenamento do Azure](https://azurestorageexplorer.codeplex.com/ "Gerenciador de Armazenamento do Azure") para acessar os dados. ![imagem](./media/virtual-machines-linux-diagnostic-extension/no1.png)Se tiver habilitado fileCfg ou perfCfg especificados no Cenário 2 e 3, você também poderá exibir dados não padrão nas ferramentas acima.##Problemas conhecidos1. Para a versão 2.0, as informações do Rsyslog e o arquivo de log especificado pelo cliente só podem ser acessados por meio de scripts.2. Para a versão 2.0, se você tiver habilitado a extensão de Diagnóstico do Linux por meio de script, não será possível exibir os dados do portal. Por outro lado, se você habilitar a extensão do portal primeiro, os scripts ainda funcionarão.Esperamos corrigir os dois problemas na próxima versão. 

<!---HONumber=August15_HO7-->