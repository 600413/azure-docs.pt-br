<properties
   pageTitle="Diretrizes de dimensionamento automático | Microsoft Azure"
   description="Diretrizes sobre como realizar o dimensionamento automático para alocar dinamicamente os recursos exigidos por um aplicativo."
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="christb"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/13/2016"
   ms.author="masashin"/>

# Diretrizes de dimensionamento automático

[AZURE.INCLUDE [pnp-header](../includes/guidance-pnp-header-include.md)]

## Visão geral
Dimensionamento automático é o processo de alocar dinamicamente os recursos exigidos por um aplicativo para atender às necessidades de desempenho e atender a SLAs (contratos de nível de serviço), minimizando simultaneamente os custos de tempo de execução. Conforme o volume de trabalho cresce, um aplicativo pode exigir recursos adicionais para poder realizar suas tarefas no tempo adequado. Conforme a demanda diminui, os recursos podem ser desalocados para minimizar os custos e, ao mesmo tempo, manter o desempenho adequado e atender aos SLAs. O Dimensionamento Automático aproveita a elasticidade de ambientes hospedados na nuvem ao mesmo tempo em que alivia a sobrecarga de gerenciamento. Ele faz isso reduzindo a necessidade de um operador ter que monitorar o desempenho de um sistema continuamente e tomar decisões sobre como adicionar ou remover recursos.
<br\>

>[AZURE.NOTE] O dimensionamento automático aplica-se a todos os recursos usados por um aplicativo, não apenas aos recursos de computação. Por exemplo, se o sistema usa filas de mensagens para enviar e receber informações, ele pode criar filas adicionais conforme é dimensionado.

## Tipos de dimensionamento
O dimensionamento normalmente assume uma das duas formas abaixo:

- **Vertical** (também conhecido como _escalar e reduzir verticalmente_). Esse formulário requer que você modifique o hardware (expanda ou reduza sua capacidade e desempenho) ou reimplante a solução usando hardware alternativo que tenha a capacidade e o desempenho apropriados. Em um ambiente de nuvem, a plataforma de hardware é geralmente um ambiente virtualizado. A menos que o hardware original tenha sido substancialmente sobreprovisionado, com a despesa de capital antecipada resultante, expandir verticalmente nesse ambiente envolve o provisionamento de recursos mais poderosos e o posterior deslocamento do sistema para esses novos recursos. O dimensionamento vertical geralmente é um processo que gera interrupção e requer que o sistema fique temporariamente indisponível enquanto é reimplantado. Pode ser possível manter o sistema original em execução enquanto o novo hardware é provisionado e colocado online, mas provavelmente ocorrerão algumas interrupções enquanto o processamento passa pela transição do ambiente antigo para o novo. É incomum usar o dimensionamento automático para implementar uma estratégia de dimensionamento vertical.
- **Horizontal** (também conhecido como _escalar e reduzir horizontalmente_). Esse formulário exige a implantação da solução em mais ou menos recursos, que normalmente não são sistemas de alta potência, mas sim recursos de mercadoria. A solução pode continuar sendo executada sem interrupção enquanto esses recursos são provisionados. Quando o processo de provisionamento for concluído, cópias dos elementos que compõem a solução poderão ser implantadas nesses recursos adicionais e tornadas disponíveis. Se a demanda diminui, os recursos adicionais podem ser recuperados após os elementos que fazem uso desses recursos terem sido desligados corretamente. Muitos sistemas baseados em nuvem, incluindo o Microsoft Azure, oferecem suporte à automação dessa forma de dimensionamento.

## Implementar uma estratégia de dimensionamento automático
Implementar uma estratégia de dimensionamento automático normalmente envolve os seguintes componentes e processos:

- Sistemas de instrumentação e monitoramento nos níveis de aplicativos, serviços e infraestrutura. Esses sistemas capturam métricas essenciais, como tempos de resposta, comprimentos de fila, utilização da CPU e uso de memória.
- Lógica de tomada de decisão, que pode avaliar os fatores de dimensionamento monitorados em relação a agendas e limites predefinidos do sistema e tomar decisões quanto a dimensionar ou não.
- Componentes que são responsáveis por realizar tarefas associadas ao dimensionamento do sistema, como provisionamento ou desprovisionamento de recursos.
- Teste, monitoramento e ajuste da estratégia de dimensionamento automático para garantir que ela funcione conforme o esperado.

A maioria dos ambientes baseados em nuvem, como o Azure, fornecem mecanismos de dimensionamento automático internos que tratam de cenários comuns. Se o ambiente ou serviço que você usa não fornece a funcionalidade de dimensionamento automatizado necessária, ou se você tem requisitos de dimensionamento automático extremos além dos seus recursos, pode haver a necessidade de uma implementação personalizada. Use essa implementação personalizada para coletar métricas de sistema e operacionais, analisá-las para identificar os dados relevantes e dimensionar os recursos adequadamente.


## Configurar o dimensionamento automático para uma solução do Azure
Há várias opções para configurar o dimensionamento automático para as soluções do Azure:

- O **Dimensionamento Automático do Azure** dá suporte aos cenários de dimensionamento mais comuns com base em uma agenda e, opcionalmente, operações de dimensionamento disparadas com base nas métricas de tempo de execução (como a utilização do processador, comprimento da fila ou contadores internos e personalizados). Você pode, com rapidez e facilidade, configurar políticas de dimensionamento automático simples para uma solução usando o portal do Azure. Para um controle mais detalhado, você pode fazer uso da [API REST do Gerenciamento de Serviços do Azure](https://msdn.microsoft.com/library/azure/ee460799.aspx) ou da [API de REST do Azure Resource Manager](https://msdn.microsoft.com//library/azure/dn790568.aspx). A [Biblioteca de Gerenciamento dos Serviços de Monitoramento do Azure](http://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring) e a [Biblioteca do Microsoft Insights](https://www.nuget.org/packages/Microsoft.Azure.Insights/) (em visualização) são SDKs que permitem a coleta de métricas de recursos diferentes e realizam o dimensionamento automático usando a API REST. Para recursos em que o suporte do Azure Resource Manager não está disponível, ou se você estiver usando os Serviços de Nuvem do Azure, a API REST do Gerenciamento de Serviços pode ser usada para dimensionamento automático. Nos outros casos, use o Azure Resource Manager.
- **Uma solução personalizada**, baseada na sua instrumentação no aplicativo e nos recursos de gerenciamento do Azure, pode ser útil. Por exemplo, você pode usar o diagnóstico do Azure ou outros métodos de instrumentação em seu aplicativo com código personalizado para monitorar continuamente e exportar métricas do aplicativo. Você pode ter regras personalizadas que funcionam nessas métricas e usam a API REST do Gerenciamento de Serviços ou do Gerenciador de Recursos para disparar o dimensionamento automático. As métricas para disparar uma operação de dimensionamento podem ser de qualquer contador interno ou personalizado, ou instrumentação de outro tipo implementada dentro do aplicativo. No entanto, uma solução personalizada não é simples de implementar e deve-se considerar essa possibilidade apenas se nenhuma das abordagens anteriores atendem a seus requisitos. O [Bloco de aplicativo de dimensionamento automático](http://msdn.microsoft.com/library/hh680892%28v=pandp.50%29.aspx) usa essa abordagem.
- **Serviços de terceiros** como [Paraleap AzureWatch](http://www.paraleap.com/AzureWatch), que permitem dimensionar uma solução baseada em agendas, indicadores de desempenho do sistema e de carga de serviço, regras personalizadas e combinações de diferentes tipos de regras.

Ao escolher qual solução de dimensionamento automático adotar, considere os pontos a seguir:

- Use recursos de dimensionamento automático internos da plataforma se eles puderem satisfazer seus requisitos. Caso contrário, avalie cuidadosamente se você realmente precisa de recursos de dimensionamento mais complexos. Alguns exemplos de requisitos adicionais podem incluir mais granularidade do controle, maneiras diferentes para detectar eventos de gatilho para dimensionamento, dimensionamento entre assinaturas e dimensionamento de outros tipos de recursos.
- Avalie se é possível prever a carga no aplicativo com precisão suficiente para depender apenas de dimensionamento automático agendado (adição e remoção de instâncias para atender a picos de demanda previstos). Quando isso não for possível, use dimensionamento automático reativo com base nas métricas coletadas em tempo de execução, para permitir que o aplicativo trate de alterações repentinas na demanda. Normalmente, você pode combinar essas abordagens. Por exemplo, crie uma estratégia que adiciona recursos como computação, armazenamento e filas com base em um agendamento dos momentos em que você sabe que o aplicativo fica mais ocupado. Isso ajuda a garantir que a capacidade esteja disponível quando necessário, sem a demora enfrentada ao iniciar novas instâncias. Além disso, para cada regra agendada, defina métricas que permitam o dimensionamento automático reativo durante esse período para garantir que o aplicativo possa dar suporte a picos de demanda prolongados, mas repentinos.
- Muitas vezes é difícil entender a relação entre os requisitos de capacidade e métricas, especialmente quando um aplicativo é inicialmente implantado. Prefira provisionar um pouco de capacidade extra no início, e então monitorar e ajustar as regras de dimensionamento automático para aproximar capacidade da carga real.

### Usar o Dimensionamento Automático do Azure
O Dimensionamento Automático permite que você configure as opções de escalonamento e redução horizontais para uma solução. O Dimensionamento Automático pode adicionar e remover automaticamente instâncias de funções de trabalho e da Web dos Serviços de Nuvem do Azure, Serviços Móveis do Azure e o recurso Aplicativos Web no Serviço de Aplicativo do Azure. Ele também pode habilitar o dimensionamento automático iniciando e parando instâncias de Máquinas Virtuais do Azure. Uma estratégia de dimensionamento automático do Azure inclui dois conjuntos de fatores:

- Dimensionamento com base em agendamento automático que pode garantir que instâncias adicionais estejam disponíveis para coincidir com um pico de utilização esperado, podendo reduzir horizontalmente após o horário de pico. Isso permite que você verifique se já tem instâncias suficientes em execução, sem esperar que o sistema reaja à carga.
- Dimensionamento automático baseado em métricas que reage a fatores como a utilização média da CPU ao longo de última hora, ou a lista de pendências de mensagens que a solução está processando em um armazenamento do Azure ou uma fila do Barramento de Serviço do Azure. Isso permite que o aplicativo reaja separadamente das regras de dimensionamento automático agendado, para acomodar alterações planejadas ou não planejadas na demanda.

Considere os seguintes pontos ao usar o Dimensionamento Automático :

- Sua estratégia de dimensionamento automático combina o dimensionamento agendado e o baseado em métricas. Você pode especificar os dois tipos de regras para um serviço.
- Você deve configurar as regras de dimensionamento automático e monitorar o desempenho do seu aplicativo ao longo do tempo. Use os resultados desse monitoramento para ajustar a maneira na qual o sistema pode ser dimensionado, se necessário. No entanto, tenha em mente que o dimensionamento automático não é um processo instantâneo. Leva tempo para reagir a uma métrica como a média de uso da CPU que excede (ou fica abaixo) de um limite especificado.
- As regras de dimensionamento automático que usam um mecanismo de detecção com base em um atributo de gatilho de medida (por exemplo, o comprimento da fila ou a utilização de CPU) usam, para disparar uma ação de dimensionamento automático, um valor agregado ao longo do tempo em vez de valores instantâneos. Por padrão, a agregação é uma média dos valores. Isso impede que o sistema reaja rápido demais ou cause oscilação rápida. Ela também dá tempo para que novas instâncias iniciadas automaticamente adequem-se ao modo de execução, impedindo que ações de dimensionamento automático adicionais ocorram enquanto as novas instâncias estão inicializando. Para Serviços de Nuvem e Máquinas Virtuais do Azure, o período padrão para a agregação é 45 minutos, então esse é o período de tempo máximo que poderá levar para a métrica disparar o dimensionamento automático em resposta a picos de demanda. Você pode alterar o período de agregação usando o SDK, mas lembre-se de que os períodos inferiores a 25 minutos podem causar resultados imprevisíveis (para saber mais, confira [Dimensionamento Automático de Serviços de Nuvem segundo o percentual de CPU com a Biblioteca de Gerenciamento de Serviços de Monitoramento do Azure](http://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/)). Para aplicativos Web, o período de cálculo da média é muito menor, permitindo que novas instâncias estejam disponíveis cerca de cinco minutos após uma alteração à medida de gatilho segundo a média.
- Se configurar o dimensionamento automático usando o SDK em vez do portal da Web, você poderá especificar uma agenda mais detalhada durante a qual as regras estão ativas. Você também pode criar suas próprias métricas e usá-las, com ou sem as métricas existentes, em suas regras de dimensionamento automático. Por exemplo, você poderá usar contadores alternativos como o número de solicitações por segundo ou a disponibilidade média de memória, ou ainda usar contadores personalizados que medem processos comerciais específicos.
- Ao dimensionar automaticamente Máquinas Virtuais do Azure, você deve implantar um número de instâncias da máquina virtual igual ao número máximo que você permitirá que sejam iniciadas pelo dimensionamento automático. Essas instâncias devem fazer parte do mesmo conjunto de disponibilidade. O mecanismo de dimensionamento automático de Máquinas Virtuais não cria nem exclui instâncias de máquina virtual; em vez disso, as regras de dimensionamento automático que você configura farão a inicialização e parada de um número apropriado dessas instâncias. Para obter mais informações, consulte [Dimensionar automaticamente um aplicativo executado em Funções Web, de Trabalho ou Máquinas Virtuais](./cloud-services/cloud-services-how-to-scale.md).
- Se não for possível iniciar novas instâncias, talvez porque o número máximo para uma assinatura foi atingido ou porque um erro ocorre durante a inicialização, o portal pode mostrar que uma operação de dimensionamento automático foi bem-sucedida. No entanto, eventos **ChangeDeploymentConfiguration** subsequentes exibidos no portal mostrarão apenas que uma inicialização de serviço foi solicitada, e não haverá nenhum evento para indicar que ela foi concluída com êxito.
- Você pode usar a interface do usuário do portal da Web para vincular recursos como instâncias de Banco de Dados SQL e filas a uma instância de serviço de computação. Isso permite que você acesse mais facilmente as opções de configuração de dimensionamento manual e automático separadas, para cada um dos recursos vinculados. Para saber mais, confira [Como vincular um recurso a um serviço de nuvem](cloud-services-how-to-manage.md#linkresources) e [Como dimensionar um aplicativo](./cloud-services/cloud-services-how-to-scale.md).
- Ao configurar várias políticas e regras, elas poderão entrar em conflito entre si. O Dimensionamento Automático usa as regras de resolução de conflitos a seguir para garantir que haja sempre um número suficiente de instâncias em execução:
  - As operações de escalamento horizontal sempre têm precedência sobre operações de redução horizontal.
  - Quando há conflito entre operações de escalamento horizontal, a regra que inicia o maior aumento no número de instâncias tem precedência.
  - Quando há conflito entre operações de redução horizontal, a regra que inicia a menor redução no número de instâncias tem precedência.

<a name="the-azure-monitoring-services-management-library"></a>

## Considerações sobre o design do aplicativo para implementação do dimensionamento automático
O dimensionamento automático não é uma solução imediata. Apenas adicionar recursos a um sistema ou executar mais instâncias de um processo não garante que o desempenho do sistema vai melhorar. Considere os seguintes pontos ao criar uma estratégia de dimensionamento automático:

- O sistema deve ser projetado para ser escalonável horizontalmente. Evite fazer suposições sobre afinidade de instância; não crie soluções que exijam que o código esteja sempre sendo executado em uma instância específica de um processo. Ao dimensionar um site ou serviço de nuvem horizontalmente, não presuma que uma série de solicitações da mesma fonte será sempre roteada para a mesma instância. Projete os serviços, por essa mesma razão, como sem monitoração de estado, evitando assim a exigência de que uma série de solicitações de um aplicativo sejam sempre roteadas para a mesma instância de um serviço. Ao criar um serviço que lê as mensagens de uma fila e as processa, não faça suposições sobre qual instância do serviço lidará com qual mensagem. O Dimensionamento Automático pode iniciar instâncias adicionais de um serviço conforme o comprimento da fila cresce. O [Padrão de Consumidores Concorrentes](http://msdn.microsoft.com/library/dn568101.aspx) descreve como administrar esse cenário.
- Se a solução implementa uma tarefa de execução longa, projete-a para oferecer suporte tanto a escalar quanto a reduzir horizontalmente. Sem o devido cuidado, essa tarefa pode impedir que uma instância de um processo seja desligada corretamente quando o sistema é reduzido horizontalmente, ou ela poderá perder dados se o processo for encerrado. Idealmente, refatore uma tarefa de execução longa e divida o processamento que ela executa em blocos menores e distintos. O [Padrão de Filtros e Tubos](http://msdn.microsoft.com/library/dn568100.aspx) fornece um exemplo de como você atingir esse resultado.
- Como alternativa, você pode implementar um mecanismo de ponto de verificação que registre informações de estado da tarefa em intervalos regulares, e salve esse estado em armazenamento durável que possa ser acessado por qualquer instância do processo executando a tarefa. Desse modo, se o processo é encerrado, o trabalho que ele estava executando poderá ser retomado do último ponto de verificação, por meio do uso de outra instância.
- Quando tarefas em segundo plano são executadas em instâncias de computação separadas, como em funções de trabalho de um aplicativo hospedado em Serviços de Nuvem, talvez seja necessário dimensionar diferentes partes do aplicativo usando diferentes políticas de dimensionamento. Por exemplo, talvez seja necessário implantar instâncias de computação de IU (interface do usuário) adicionais sem aumentar o número de instâncias de computação em segundo plano, ou fazer o oposto disso. Se você oferecer níveis diferentes de serviço (como pacotes de serviço básicos e premium), talvez seja necessário escalar horizontalmente os recursos de computação para pacotes de serviço premium de modo mais agressivo do que aqueles para pacotes de serviço básico, para assim atender aos SLAs.
- Considere usar o comprimento da fila, pela qual a interface do usuário e as instâncias de computação em segundo plano se comunicam, como um critério da sua estratégia de dimensionamento automático. Esse é o melhor indicador de um desequilíbrio ou a diferença entre a carga atual e a capacidade de processamento da tarefa em segundo plano.
- Se sua estratégia de dimensionamento automático em contadores que medem processos de negócios, como o número de pedidos feitos por hora ou o tempo médio de execução de uma transação complexa, certifique-se de entender completamente a relação entre os resultados desses tipos de contadores e os reais requisitos de capacidade de computação. Pode ser necessário dimensionar mais de um componente ou unidade de computação em resposta a alterações nos contadores de processo empresarial.
- Para evitar que o sistema tente escalar horizontalmente de modo excessivo e para evitar os custos associados à execução de vários milhares de instâncias, considere a possibilidade de limitar o número máximo de instâncias que podem ser adicionadas automaticamente. A maioria dos mecanismos de dimensionamento automático permitem que você especifique os números mínimo e máximo de instâncias para uma regra. Além disso, considere degradar normalmente a funcionalidade que o sistema oferece se o número máximo de instâncias tiverem sido implantadas e, ainda assim, o sistema estiver sobrecarregado.
- Mantenha em mente que dimensionamento automático pode não ser o mecanismo mais apropriado para lidar com um aumento repentino na carga de trabalho. Leva tempo para provisionar e iniciar novas instâncias de um serviço ou adicionar recursos a um sistema, e o pico da demanda pode já ter passado quando esses recursos adicionais forem disponibilizados. Nesse cenário, talvez seja melhor limitar o serviço. Para obter mais informações, consulte [Padrão de limitação](http://msdn.microsoft.com/library/dn589798.aspx).
- Por outro lado, se você precisa da capacidade de processar todas as solicitações quando o volume flutua rapidamente e o custo não é um fator principal, considere usar uma estratégia de dimensionamento automático agressiva que inicia as instâncias adicionais mais rapidamente. Você também pode usar uma política programada que inicie um número suficiente de instâncias para atender à carga máxima antes que ela seja esperada.
- O mecanismo de dimensionamento automático deve monitorar o processo de dimensionamento automático e registrar os detalhes de cada evento desse dimensionamento (o que o disparou, quais recursos foram adicionados ou removidos e quando isso ocorreu). Se você criar um mecanismo de dimensionamento automático personalizado, certifique-se de que ele incorpora essa funcionalidade. Analise as informações para ajudar a medir a eficiência da estratégia de dimensionamento automático e ajustá-la se necessário. Você pode ajustar tanto a curto prazo, conforme os padrões de uso tornam-se mais óbvios, quanto a longo prazo, conforme os negócios se expandem ou os requisitos do aplicativo evoluem. Se um aplicativo atinge o limite superior definido para o dimensionamento automático, o mecanismo também pode alertar um operador, que pode iniciar recursos adicionais manualmente se necessário. Observe que, sob essas circunstâncias, o operador também pode ser responsável por remover manualmente esses recursos após redução na carga de trabalho.

## Diretrizes e padrões relacionados
Os padrões e diretrizes a seguir também podem ser relevantes a esse cenário ao implementar o dimensionamento automático:

- [Padrão de Limitação](http://msdn.microsoft.com/library/dn589798.aspx). Esse padrão descreve como um aplicativo pode continuar a funcionar e cumprir os contratos de nível de serviço quando um aumento na demanda coloca uma carga extrema sobre os recursos. É possível usar limitação com o dimensionamento automático para evitar que, ao escalar horizontalmente o sistema, este seja sobrecarregado.
- [Padrão Consumidores Concorrentes](http://msdn.microsoft.com/library/dn568101.aspx) Esse padrão descreve como implementar um conjunto de instâncias de serviço que pode lidar com mensagens de qualquer instância do aplicativo. O dimensionamento automático pode ser usado para iniciar e parar as instâncias de serviço de acordo com a carga de trabalho prevista. Essa abordagem permite que um sistema processe várias mensagens simultaneamente para otimizar o resultado, melhorar a escalabilidade e disponibilidade e equilibrar a carga de trabalho.
- [Diretrizes sobre Instrumentação e Telemetria](http://msdn.microsoft.com/library/dn589775.aspx). Instrumentação e telemetria são essenciais para reunir as informações que podem orientar o processo de dimensionamento automático.

## Mais informações
- [Como Dimensionar um Aplicativo](./cloud-services/cloud-services-how-to-scale.md)
- [Dimensionar automaticamente um aplicativo executado em Funções Web, de Trabalho ou Máquinas Virtuais](cloud-services-how-to-manage.md#linkresources)
- [Como vincular um recurso a um serviço de nuvem](cloud-services-how-to-manage.md#linkresources)
- [Dimensionar recursos vinculados](./cloud-services/cloud-services-how-to-scale.md#scale-link-resources)
- [Biblioteca de Gerenciamento de Serviços de Monitoramento do Azure](http://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring)
- [API REST de Gerenciamento de Serviços do Azure](http://msdn.microsoft.com/library/azure/ee460799.aspx)
- [APIs REST do Gerenciador de Recursos do Azure](https://msdn.microsoft.com/library/azure/dn790568.aspx)
- [Biblioteca do Microsoft Insights](https://www.nuget.org/packages/Microsoft.Azure.Insights/)
- [Operações em Dimensionamento Automático](http://msdn.microsoft.com/library/azure/dn510374.aspx)
- [Microsoft.WindowsAzure.Management.Monitoring.Autoscale Namespace](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.management.monitoring.autoscale.aspx)

<!---HONumber=AcomDC_0720_2016-->